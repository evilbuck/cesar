---
phase: 02-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - cesar/api/__init__.py
  - cesar/api/models.py
  - tests/test_models.py
  - pyproject.toml
autonomous: true

must_haves:
  truths:
    - "Job can be created with default queued state"
    - "Job status transitions are type-safe via enum"
    - "Job timestamps use UTC"
    - "Job result fields (text, language) are optional until completion"
    - "Job error_message is optional until failure"
    - "Model validates model_size to known values"
  artifacts:
    - path: "cesar/api/__init__.py"
      provides: "API package initialization"
      min_lines: 1
    - path: "cesar/api/models.py"
      provides: "JobStatus enum and Job Pydantic model"
      exports: ["JobStatus", "Job"]
      min_lines: 40
    - path: "tests/test_models.py"
      provides: "Unit tests for Job model"
      min_lines: 50
  key_links:
    - from: "cesar/api/models.py"
      to: "pydantic"
      via: "BaseModel inheritance"
      pattern: "class Job\\(BaseModel\\)"
    - from: "cesar/api/models.py"
      to: "enum"
      via: "JobStatus enum"
      pattern: "class JobStatus\\(str, Enum\\)"
---

<objective>
Create the Job data model with Pydantic v2 and JobStatus enum for transcription job lifecycle.

Purpose: Establish the core data model that represents transcription jobs throughout the system. This model will be used by the repository layer, API endpoints, and background worker.

Output: `cesar/api/models.py` with Job model and JobStatus enum, plus comprehensive unit tests.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-foundation/02-RESEARCH.md

# Existing codebase
@cesar/__init__.py
@cesar/transcriber.py
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Job model and JobStatus enum</name>
  <files>
    cesar/api/__init__.py
    cesar/api/models.py
    pyproject.toml
  </files>
  <action>
1. Create `cesar/api/` directory with `__init__.py` that exports Job and JobStatus

2. Create `cesar/api/models.py` with:
   - `JobStatus(str, Enum)` with values: QUEUED, PROCESSING, COMPLETED, ERROR
   - `Job(BaseModel)` with Pydantic v2 ConfigDict:
     - `id: str` - default_factory using uuid4
     - `status: JobStatus` - default QUEUED
     - `audio_path: str` - required
     - `model_size: str` - default "base", validated to {tiny, base, small, medium, large}
     - `created_at: datetime` - default_factory using datetime.utcnow
     - `started_at: Optional[datetime]` - None
     - `completed_at: Optional[datetime]` - None
     - `result_text: Optional[str]` - None
     - `detected_language: Optional[str]` - None
     - `error_message: Optional[str]` - None

3. Use ConfigDict with:
   - `from_attributes=True` (for ORM-style access)
   - `str_strip_whitespace=True`
   - `extra='forbid'` (fail fast on unknown fields)

4. Add `@field_validator('model_size')` to validate model size

5. Update pyproject.toml to add dependencies:
   - `pydantic>=2.0.0`
   - `aiosqlite>=0.22.0`

Note: Use `datetime.utcnow()` per research doc (Python 3.12 deprecation warning is acceptable for now).
  </action>
  <verify>
    python -c "from cesar.api.models import Job, JobStatus; j = Job(audio_path='/test.mp3'); print(j.status, j.id)"
  </verify>
  <done>
    Job model imports successfully, creates with default queued state and auto-generated UUID
  </done>
</task>

<task type="auto">
  <name>Task 2: Create comprehensive model tests</name>
  <files>tests/test_models.py</files>
  <action>
Create `tests/test_models.py` with unittest TestCase covering:

1. **JobStatus tests:**
   - All four status values exist (QUEUED, PROCESSING, COMPLETED, ERROR)
   - Status values are strings matching expected lowercase values
   - Can convert string to enum and back

2. **Job creation tests:**
   - Job created with only audio_path gets default values (queued status, auto UUID, created_at timestamp)
   - Job created with all fields preserves all values
   - Job id is valid UUID format
   - Job created_at is set to approximately now (within 1 second)

3. **Job validation tests:**
   - Invalid model_size raises ValidationError
   - Valid model_size values all work (tiny, base, small, medium, large)
   - Extra fields raise ValidationError (extra='forbid')
   - Empty audio_path raises ValidationError

4. **Optional field tests:**
   - Optional fields default to None (started_at, completed_at, result_text, detected_language, error_message)
   - Optional fields can be set to values
   - Timestamps can be datetime objects

5. **Serialization tests:**
   - Job can be serialized to dict via model_dump()
   - Job can be serialized to JSON via model_dump_json()
   - Job can be recreated from dict
  </action>
  <verify>
    python -m pytest tests/test_models.py -v
  </verify>
  <done>
    All model tests pass, covering creation, validation, optional fields, and serialization
  </done>
</task>

</tasks>

<verification>
Run full test suite to ensure no regressions:
```bash
python -m pytest tests/ -v
```

Verify model can be imported and used:
```bash
python -c "
from cesar.api.models import Job, JobStatus
import json

# Create job
job = Job(audio_path='/path/to/audio.mp3')
print(f'Created job: {job.id}')
print(f'Status: {job.status}')
print(f'Created at: {job.created_at}')

# Verify JSON serialization
job_json = job.model_dump_json()
print(f'JSON: {job_json[:100]}...')

# Verify all statuses
for status in JobStatus:
    print(f'Status: {status.value}')
"
```
</verification>

<success_criteria>
- [ ] `cesar/api/models.py` exists with Job and JobStatus
- [ ] Job model has all required fields per requirements (JOB-02, JOB-03, JOB-04, RES-01, RES-02)
- [ ] JobStatus enum has four states: queued, processing, completed, error
- [ ] Model validation works (model_size, extra fields)
- [ ] All tests in `tests/test_models.py` pass
- [ ] Dependencies added to pyproject.toml
- [ ] No regressions in existing tests
</success_criteria>

<output>
After completion, create `.planning/phases/02-foundation/02-01-SUMMARY.md`
</output>
