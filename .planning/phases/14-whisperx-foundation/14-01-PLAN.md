---
phase: 14-whisperx-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
autonomous: true

must_haves:
  truths:
    - "whisperx package installs successfully in clean environment"
    - "torch and torchaudio versions are compatible with whisperx"
    - "pyannote.audio direct dependency is removed (whisperx bundles it)"
  artifacts:
    - path: "pyproject.toml"
      provides: "Updated dependencies for WhisperX"
      contains: "whisperx"
  key_links:
    - from: "pyproject.toml"
      to: "whisperx package"
      via: "pip install"
      pattern: "whisperx>=3\\.7\\.6"
---

<objective>
Update project dependencies to use WhisperX instead of direct pyannote.audio

Purpose: WhisperX bundles pyannote-audio, faster-whisper, and torch. Removing direct pyannote dependency and adding whisperx simplifies dependency management and ensures compatible versions.

Output: Updated pyproject.toml with whisperx dependency
</objective>

<execution_context>
@/home/buckleyrobinson/.claude/get-shit-done/workflows/execute-plan.md
@/home/buckleyrobinson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-whisperx-foundation/14-RESEARCH.md
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update pyproject.toml dependencies</name>
  <files>pyproject.toml</files>
  <action>
Update dependencies in pyproject.toml:

1. Remove `pyannote.audio>=3.1.0` from dependencies list
   - WhisperX bundles pyannote-audio transitively
   - Keeping both can cause version conflicts

2. Add `whisperx>=3.7.6` to dependencies list
   - Place after existing dependencies
   - This brings in: pyannote-audio, faster-whisper, torch, torchaudio

3. Keep all other existing dependencies unchanged:
   - click>=8.0.0
   - rich>=13.0.0
   - faster-whisper>=1.0.0 (keep for now - backward compat, whisperx also uses it)
   - pydantic>=2.0.0
   - aiosqlite>=0.22.0
   - fastapi>=0.109.0
   - uvicorn>=0.25.0
   - python-multipart>=0.0.6
   - httpx>=0.26.0
   - yt-dlp>=2024.1.0

Note: Keep faster-whisper for now as existing transcriber.py uses it directly. Phase 15 will determine if we fully migrate transcription to WhisperX.
  </action>
  <verify>
Run: `grep -E "whisperx|pyannote" pyproject.toml`
Expected: Shows `whisperx>=3.7.6`, does NOT show `pyannote.audio`
  </verify>
  <done>
pyproject.toml has whisperx dependency and no direct pyannote.audio dependency
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify installation in virtual environment</name>
  <files>None (verification only)</files>
  <action>
Test the dependency changes actually work:

1. Install updated dependencies in existing venv:
   ```
   pip install -e .
   ```

2. Verify whisperx imports correctly:
   ```
   python -c "import whisperx; print(f'WhisperX version: {whisperx.__version__}')"
   ```

3. Verify pyannote is available (bundled with whisperx):
   ```
   python -c "from pyannote.audio import Pipeline; print('pyannote available')"
   ```

4. Verify torch is available:
   ```
   python -c "import torch; print(f'PyTorch: {torch.__version__}')"
   ```

If any import fails, check error messages and adjust pyproject.toml accordingly.

Common issues:
- CUDA version mismatch: whisperx may install torch with specific CUDA version
- Architecture mismatch: CPU vs GPU torch variants
- If torch import fails with CUDA errors on CPU-only machine, that's OK - the library is installed
  </action>
  <verify>
Run: `pip list | grep -i whisperx`
Expected: Shows whisperx version 3.7.6 or higher

Run: `python -c "import whisperx; print('OK')"`
Expected: Prints "OK" without import errors
  </verify>
  <done>
whisperx and its dependencies (pyannote, torch) import successfully
  </done>
</task>

</tasks>

<verification>
1. `grep "whisperx" pyproject.toml` shows the dependency
2. `grep "pyannote.audio" pyproject.toml` returns nothing (removed)
3. `pip list | grep -i whisperx` shows installed version
4. `python -c "import whisperx; print('OK')"` succeeds
</verification>

<success_criteria>
- pyproject.toml updated with whisperx>=3.7.6
- pyannote.audio direct dependency removed from pyproject.toml
- whisperx package imports successfully in Python
- Existing cesar imports still work (no regressions)
</success_criteria>

<output>
After completion, create `.planning/phases/14-whisperx-foundation/14-01-SUMMARY.md`
</output>
