---
phase: 01-package-cli-structure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - cesar/__init__.py
  - cesar/__main__.py
  - cesar/cli.py
  - cesar/transcriber.py
  - cesar/device_detection.py
  - cesar/utils.py
autonomous: true

must_haves:
  truths:
    - "cesar/ package directory exists with all modules"
    - "pyproject.toml defines cesar as installable package"
    - "Entry point cesar = cesar.cli:cli is registered"
    - "Python version >=3.10 is specified"
  artifacts:
    - path: "pyproject.toml"
      provides: "Package configuration with entry point"
      contains: "[project.scripts]"
    - path: "cesar/__init__.py"
      provides: "Package initialization with version"
      contains: "__version__"
    - path: "cesar/__main__.py"
      provides: "python -m cesar support"
      contains: "from cesar.cli import"
    - path: "cesar/cli.py"
      provides: "CLI entry point"
      contains: "@click.group"
    - path: "cesar/transcriber.py"
      provides: "Core transcription logic"
      contains: "class AudioTranscriber"
  key_links:
    - from: "pyproject.toml"
      to: "cesar.cli:cli"
      via: "[project.scripts] entry point"
      pattern: 'cesar = "cesar.cli:cli"'
    - from: "cesar/cli.py"
      to: "cesar/transcriber.py"
      via: "import statement"
      pattern: "from cesar.transcriber import"
---

<objective>
Create Python package structure and pyproject.toml for pipx-installable cesar CLI

Purpose: Transform flat Python scripts into a proper package that can be installed via pipx
Output: cesar/ package directory + pyproject.toml with entry point configured
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-package-cli-structure/01-RESEARCH.md

# Current files to restructure
@cli.py
@transcriber.py
@device_detection.py
@utils.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create cesar package directory with module files</name>
  <files>
    cesar/__init__.py
    cesar/__main__.py
    cesar/cli.py
    cesar/transcriber.py
    cesar/device_detection.py
    cesar/utils.py
  </files>
  <action>
    1. Create cesar/ directory

    2. Create cesar/__init__.py with single-source versioning:
       - Import version from importlib.metadata
       - Use try/except with "0.0.0" fallback for development
       - Add brief package docstring

    3. Create cesar/__main__.py for python -m cesar support:
       - Import cli from cesar.cli
       - Call cli() in __main__ block

    4. Copy module files into cesar/ directory:
       - cli.py -> cesar/cli.py
       - transcriber.py -> cesar/transcriber.py
       - device_detection.py -> cesar/device_detection.py
       - utils.py -> cesar/utils.py

    5. Update ALL imports in copied files to use package prefix:
       - "from transcriber import" -> "from cesar.transcriber import"
       - "from utils import" -> "from cesar.utils import"
       - "from device_detection import" -> "from cesar.device_detection import"

    6. Convert cesar/cli.py from single command to command group:
       - Change @click.command() to @click.group()
       - Rename main() to cli() as the group function
       - Create transcribe() function with @cli.command() decorator
       - Move existing main() body into transcribe()
       - Update @click.version_option to use importlib.metadata.version("cesar")
       - Add docstring "Cesar: Offline audio transcription using faster-whisper"

    IMPORTANT: Do NOT delete the original root-level files yet. They will be cleaned up after tests pass.
  </action>
  <verify>
    python -c "from cesar import __version__; print(__version__)"
    python -c "from cesar.cli import cli; print(type(cli))"
    python -c "from cesar.transcriber import AudioTranscriber; print(AudioTranscriber)"
  </verify>
  <done>
    - cesar/ directory exists with __init__.py, __main__.py, cli.py, transcriber.py, device_detection.py, utils.py
    - All internal imports use cesar. prefix
    - cli.py exports a click.Group named cli with transcribe subcommand
    - __version__ is retrievable from cesar package
  </done>
</task>

<task type="auto">
  <name>Task 2: Create pyproject.toml with entry point</name>
  <files>pyproject.toml</files>
  <action>
    Create pyproject.toml with setuptools build backend:

    1. [build-system]:
       - requires = ["setuptools>=61.0"]
       - build-backend = "setuptools.build_meta"

    2. [project]:
       - name = "cesar"
       - version = "1.0.0"
       - description = "Offline audio transcription CLI using faster-whisper"
       - readme = "README.md"
       - requires-python = ">=3.10"
       - dependencies:
         - "click>=8.0.0"
         - "rich>=13.0.0"
         - "faster-whisper>=1.0.0"
       - classifiers for Python 3.10, 3.11, 3.12 and Console environment

    3. [project.scripts]:
       - cesar = "cesar.cli:cli"

    4. [tool.setuptools.packages.find]:
       - where = ["."]
       - include = ["cesar*"]

    Do NOT include license field (no LICENSE file exists).
    Do NOT include authors field (not specified).
  </action>
  <verify>
    python -c "import tomllib; print(tomllib.load(open('pyproject.toml', 'rb'))['project']['scripts'])"
  </verify>
  <done>
    - pyproject.toml exists with valid TOML syntax
    - Entry point cesar = "cesar.cli:cli" is defined
    - Dependencies include click, rich, faster-whisper
    - Python >=3.10 is specified
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify package is importable and entry point works</name>
  <files>None (verification only)</files>
  <action>
    1. Install package in development mode:
       pip install -e .

    2. Verify imports work:
       python -c "from cesar import __version__; print(f'Version: {__version__}')"
       python -c "from cesar.cli import cli; print(f'CLI type: {type(cli)}')"
       python -c "from cesar.transcriber import AudioTranscriber; print('Transcriber OK')"

    3. Verify entry point registered:
       cesar --help
       cesar --version
       cesar transcribe --help

    4. If any verification fails, fix the issue before proceeding.
  </action>
  <verify>
    cesar --version  # Should show "cesar, version 1.0.0"
    cesar --help  # Should show "Cesar: Offline audio transcription..."
    cesar transcribe --help  # Should show transcribe options
  </verify>
  <done>
    - pip install -e . succeeds
    - cesar --version shows version number
    - cesar --help shows available commands
    - cesar transcribe --help shows transcribe options
  </done>
</task>

</tasks>

<verification>
All commands must pass:

```bash
# Package structure
ls cesar/__init__.py cesar/__main__.py cesar/cli.py cesar/transcriber.py

# Imports work
python -c "from cesar import __version__; print(__version__)"
python -c "from cesar.cli import cli"
python -c "from cesar.transcriber import AudioTranscriber"

# Entry point works after pip install -e .
cesar --version
cesar --help
cesar transcribe --help
```
</verification>

<success_criteria>
1. cesar/ package directory exists with all modules
2. pyproject.toml defines cesar as installable package
3. Entry point cesar = cesar.cli:cli is registered
4. cesar --version shows "cesar, version 1.0.0"
5. cesar --help shows available commands including transcribe
6. cesar transcribe --help shows all transcribe options
</success_criteria>

<output>
After completion, create `.planning/phases/01-package-cli-structure/01-01-SUMMARY.md`
</output>
