---
phase: 01-package-cli-structure
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - tests/__init__.py
  - tests/test_cli.py
  - tests/test_validation.py
  - tests/test_transcription.py
  - tests/test_model.py
  - tests/test_parallel_processing.py
autonomous: true

must_haves:
  truths:
    - "All tests in tests/ directory pass"
    - "Tests import from cesar package (not root modules)"
    - "Root-level test files removed (test_cli.py, test_utils.py, etc.)"
    - "Root-level module files removed (cli.py, transcriber.py, etc.)"
  artifacts:
    - path: "tests/__init__.py"
      provides: "Test package marker"
      min_lines: 1
    - path: "tests/test_cli.py"
      provides: "CLI tests"
      contains: "from cesar"
  key_links:
    - from: "tests/test_cli.py"
      to: "cesar/cli.py"
      via: "import statement"
      pattern: "from cesar.cli import"
    - from: "tests/test_validation.py"
      to: "cesar/transcriber.py"
      via: "import statement"
      pattern: "from cesar"
---

<objective>
Update tests to use cesar package imports and clean up old files

Purpose: Ensure tests work with new package structure and remove duplicate/old files
Output: Passing test suite with clean project structure
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-package-cli-structure/01-01-SUMMARY.md

# Test files to update
@tests/test_cli.py
@tests/test_validation.py
@tests/test_transcription.py
@tests/test_model.py
@tests/test_parallel_processing.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update tests/ directory imports to use cesar package</name>
  <files>
    tests/__init__.py
    tests/test_cli.py
    tests/test_validation.py
    tests/test_transcription.py
    tests/test_model.py
    tests/test_parallel_processing.py
  </files>
  <action>
    1. Create tests/__init__.py if it doesn't exist (can be empty or with brief docstring)

    2. Update each test file in tests/ to use cesar package imports:

       For tests/test_cli.py:
       - "from cli import" -> "from cesar.cli import"
       - Update any references to the old main() to use cli or transcribe command

       For tests/test_validation.py:
       - "from transcriber import" -> "from cesar.transcriber import"
       - "from utils import" -> "from cesar.utils import"

       For tests/test_transcription.py:
       - "from transcriber import" -> "from cesar.transcriber import"

       For tests/test_model.py:
       - "from transcriber import" -> "from cesar.transcriber import"
       - "from device_detection import" -> "from cesar.device_detection import"

       For tests/test_parallel_processing.py:
       - Update any imports to use cesar. prefix

    3. If CLI tests reference old command structure (single command):
       - Update to test the transcribe subcommand
       - Test cesar --version and cesar --help
       - Test cesar transcribe --help
  </action>
  <verify>
    cd /home/buckleyrobinson/projects/cesar && python -m pytest tests/ -v --tb=short
  </verify>
  <done>
    - tests/__init__.py exists
    - All test files use cesar. prefix imports
    - pytest tests/ passes without import errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove root-level duplicate files</name>
  <files>
    cli.py (delete)
    transcriber.py (delete)
    device_detection.py (delete)
    utils.py (delete)
    transcribe.py (delete)
    test_cli.py (delete)
    test_transcriber.py (delete)
    test_device_detection.py (delete)
    test_utils.py (delete)
  </files>
  <action>
    After tests pass, remove the old root-level files that have been moved to cesar/:

    1. Remove old module files (now in cesar/):
       rm cli.py transcriber.py device_detection.py utils.py transcribe.py

    2. Remove root-level test files (duplicates of tests/):
       rm test_cli.py test_transcriber.py test_device_detection.py test_utils.py

    3. Verify project structure is clean:
       - cesar/ package exists with modules
       - tests/ directory exists with test files
       - No duplicate .py files at root level (except any intentional scripts)

    IMPORTANT: Only delete files AFTER tests pass. If tests fail, fix them first.
  </action>
  <verify>
    ls *.py 2>/dev/null | grep -v "^prd\.md$" | wc -l  # Should be 0 (no .py files at root)
    ls cesar/*.py | wc -l  # Should be 6 (all module files)
    ls tests/*.py | wc -l  # Should be 5+ (all test files)
  </verify>
  <done>
    - No Python module files at project root (only cesar/ package)
    - All tests in tests/ directory
    - Project structure matches package layout
  </done>
</task>

<task type="auto">
  <name>Task 3: Run full test suite and verify clean state</name>
  <files>None (verification only)</files>
  <action>
    1. Run the complete test suite:
       python -m pytest tests/ -v

    2. Verify CLI still works:
       cesar --version
       cesar --help
       cesar transcribe --help

    3. Verify package imports:
       python -c "from cesar.transcriber import AudioTranscriber; print('OK')"
       python -c "from cesar.cli import cli; print('OK')"
       python -c "from cesar.utils import format_time; print('OK')"
       python -c "from cesar.device_detection import OptimalConfiguration; print('OK')"

    4. Verify clean project structure:
       ls -la (should show cesar/, tests/, pyproject.toml, no stray .py files)
  </action>
  <verify>
    python -m pytest tests/ -v --tb=short
    cesar --version
    cesar transcribe --help
  </verify>
  <done>
    - All tests pass
    - CLI commands work (--version, --help, transcribe --help)
    - Project structure is clean
  </done>
</task>

</tasks>

<verification>
All commands must pass:

```bash
# Tests pass
python -m pytest tests/ -v

# CLI works
cesar --version
cesar --help
cesar transcribe --help

# No stray Python files at root
ls *.py 2>/dev/null  # Should show nothing or only intentional scripts

# Package structure correct
ls cesar/
ls tests/
```
</verification>

<success_criteria>
1. All tests in tests/ pass with pytest
2. No import errors from cesar package
3. Root-level duplicate files removed
4. CLI commands work correctly
5. Project structure follows package layout
</success_criteria>

<output>
After completion, create `.planning/phases/01-package-cli-structure/01-02-SUMMARY.md`
</output>
