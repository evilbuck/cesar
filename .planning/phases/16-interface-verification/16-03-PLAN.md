---
phase: 16-interface-verification
plan: 03
type: execute
wave: 2
depends_on: ["16-01", "16-02"]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "All existing diarization unit tests pass"
    - "Full test suite runs without failures"
    - "No regressions from WhisperX migration"
  artifacts: []
  key_links: []
---

<objective>
Verify all existing diarization tests pass and complete full test suite validation.

Purpose: Verify requirement WX-10 (all existing diarization tests pass with updated mocks). This proves no regressions from the WhisperX migration.
Output: Passing test suite with documented verification.
</objective>

<execution_context>
@/home/buckleyrobinson/.claude/get-shit-done/workflows/execute-plan.md
@/home/buckleyrobinson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-interface-verification/16-CONTEXT.md

# Prior plan summaries (needed for context on E2E tests added)
@.planning/phases/16-interface-verification/16-01-SUMMARY.md
@.planning/phases/16-interface-verification/16-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run and verify diarization-related test suites</name>
  <files></files>
  <action>
Run the specific diarization-related test files and verify all pass:

1. **Run test_whisperx_wrapper.py:**
   ```bash
   cd /home/buckleyrobinson/projects/cesar && python -m pytest tests/test_whisperx_wrapper.py -v
   ```
   This tests the WhisperX wrapper module directly.

2. **Run test_orchestrator.py:**
   ```bash
   cd /home/buckleyrobinson/projects/cesar && python -m pytest tests/test_orchestrator.py -v
   ```
   This tests the orchestrator with WhisperX pipeline integration.

3. **Run test_diarization.py:**
   ```bash
   cd /home/buckleyrobinson/projects/cesar && python -m pytest tests/test_diarization.py -v
   ```
   This tests diarization exceptions and error handling.

4. **Run test_transcript_formatter.py:**
   ```bash
   cd /home/buckleyrobinson/projects/cesar && python -m pytest tests/test_transcript_formatter.py -v
   ```
   This tests Markdown output formatting.

5. **Run test_worker.py:**
   ```bash
   cd /home/buckleyrobinson/projects/cesar && python -m pytest tests/test_worker.py -v
   ```
   This tests the background worker with diarization support.

If any tests fail, diagnose the issue:
- Check if mocks need updating for WhisperX changes
- Check import paths match current module structure
- Fix any issues found

Document the test counts and results.
  </action>
  <verify>
All five test files should show all tests passing:
- test_whisperx_wrapper.py: All tests pass
- test_orchestrator.py: All tests pass
- test_diarization.py: All tests pass
- test_transcript_formatter.py: All tests pass
- test_worker.py: All tests pass
  </verify>
  <done>
All diarization-related test files pass with 0 failures.
  </done>
</task>

<task type="auto">
  <name>Task 2: Run complete test suite and document results</name>
  <files></files>
  <action>
Run the complete test suite to verify no regressions:

1. **Run full test suite:**
   ```bash
   cd /home/buckleyrobinson/projects/cesar && python -m pytest tests/ -v --tb=short 2>&1 | tail -50
   ```
   Capture the summary output.

2. **Document known issues:**
   From STATE.md, there are pre-existing test failures:
   - TestYouTubeErrorFormatting (mock issues with CliRunner)
   - TestCLIConfigLoading (mock issues with CliRunner)

   These are pre-existing issues documented before Phase 16 and are NOT regressions from WhisperX migration.

3. **Verify new E2E tests pass:**
   ```bash
   cd /home/buckleyrobinson/projects/cesar && python -m pytest tests/test_cli.py::TestDiarizationE2E tests/test_server.py::TestTranscribeEndpointDiarizationE2E -v
   ```

4. **Create summary of results:**
   - Total tests run
   - Tests passed
   - Tests failed (with classification: pre-existing vs new)
   - Coverage of WX-* requirements

The goal is to confirm:
- All NEW tests (from Plans 01 and 02) pass
- All diarization-related tests pass
- Any failures are pre-existing issues (not WhisperX migration regressions)
  </action>
  <verify>
```bash
cd /home/buckleyrobinson/projects/cesar && python -m pytest tests/ -v --tb=short 2>&1 | grep -E "(PASSED|FAILED|ERROR|=====)"
```
Expected: New E2E tests pass. Any failures are in pre-existing known issues only.
  </verify>
  <done>
- Full test suite executed
- New E2E tests (TestDiarizationE2E, TestTranscribeEndpointDiarizationE2E) pass
- All diarization-related tests pass
- Any failures are pre-existing (documented in STATE.md)
- Requirement WX-10 verified: all existing diarization tests pass
  </done>
</task>

</tasks>

<verification>
Final verification command:
```bash
cd /home/buckleyrobinson/projects/cesar && python -m pytest tests/ --ignore=venv -v 2>&1 | tail -30
```

Expected results:
- TestDiarizationE2E: 5 passed
- TestTranscribeEndpointDiarizationE2E: 6 passed
- test_whisperx_wrapper.py: All passed
- test_orchestrator.py: All passed
- No new failures introduced by Phase 16
</verification>

<success_criteria>
1. All diarization-related test files pass (test_whisperx_wrapper, test_orchestrator, test_diarization, test_transcript_formatter, test_worker)
2. New E2E test classes from Plans 01 and 02 pass
3. Any test failures are pre-existing issues (not Phase 16 regressions)
4. Requirement WX-10 verified: all existing diarization tests pass with updated mocks
5. Phase 16 requirements fully verified:
   - WX-06: CLI --diarize flag works unchanged (verified by TestDiarizationE2E)
   - WX-07: API diarize parameter works unchanged (verified by TestTranscribeEndpointDiarizationE2E)
   - WX-10: All existing diarization tests pass
   - WX-11: E2E CLI test produces correct output
   - WX-12: E2E API test produces correct response
</success_criteria>

<output>
After completion, create `.planning/phases/16-interface-verification/16-03-SUMMARY.md`
</output>
