# Milestone v2.1: YouTube Transcription

**Status:** SHIPPED 2026-02-01
**Phases:** 6-8
**Total Plans:** 7

## Overview

Transcribe YouTube videos directly by URL without manual download.

## Phases

### Phase 6: Core YouTube Module

**Goal**: YouTube audio extraction module with FFmpeg validation
**Depends on**: Phase 5 (v2.0 API shipped)
**Requirements**: YT-01, YT-02, YT-03, YT-04, SYS-01, SYS-02
**Success Criteria** (what must be TRUE):
  1. User can pass YouTube URL to youtube_handler.download_youtube_audio() and receive temp audio file path
  2. Best quality audio extracted from YouTube video using yt-dlp
  3. Temp audio files automatically cleaned up after successful transcription
  4. Temp audio files automatically cleaned up when download or transcription fails
  5. FFmpeg presence validated on startup before accepting YouTube jobs
**Plans**: 1 plan

Plans:
- [x] 06-01-PLAN.md — Core youtube_handler module with FFmpeg validation, URL detection, and yt-dlp download

**Details:**
- Created youtube_handler.py with 5 exception classes and 6 public functions
- Comprehensive URL validation for watch, shorts, youtu.be, embed, and /v/ formats
- 33 unit tests covering all code paths

### Phase 7: Interface Integration

**Goal**: CLI and API interfaces accept YouTube URLs with progress feedback
**Depends on**: Phase 6
**Requirements**: INT-01, INT-02, SYS-03, UX-01, UX-02
**Success Criteria** (what must be TRUE):
  1. User can run cesar transcribe <youtube-url> -o output.txt and get transcript
  2. User can POST /transcribe/url with YouTube URL and job processes successfully
  3. CLI displays download progress during YouTube audio extraction
  4. API job status endpoint reports download phase with progress percentage
  5. GET /health endpoint reports FFmpeg and YouTube support availability
**Plans**: 3 plans

Plans:
- [x] 07-01-PLAN.md — CLI YouTube support with download progress display
- [x] 07-02-PLAN.md — API YouTube routing, DOWNLOADING status, and health reporting
- [x] 07-03-PLAN.md — Gap closure: Worker YouTube download handling with status tracking

**Details:**
- CLI accepts YouTube URLs with indeterminate spinner during download
- API adds DOWNLOADING status and download_progress (0-100) field
- Worker handles YouTube downloads with status transitions
- Health endpoint reports FFmpeg availability

### Phase 8: Error Handling & Documentation

**Goal**: Comprehensive error handling and user documentation
**Depends on**: Phase 7
**Requirements**: ERR-01, ERR-02, ERR-03, ERR-04
**Success Criteria** (what must be TRUE):
  1. Invalid YouTube URLs return clear error message explaining URL format
  2. Private or unavailable videos return clear error message indicating access issue
  3. Network failures during download return clear error message suggesting retry
  4. YouTube rate limiting (403/429) returns clear error message with explanation
  5. README.md includes YouTube transcription examples and yt-dlp dependency notes
**Plans**: 3 plans

Plans:
- [x] 08-01-PLAN.md — Enhanced YouTube error types and detection patterns
- [x] 08-02-PLAN.md — CLI and API error response formatting
- [x] 08-03-PLAN.md — YouTube documentation in README

**Details:**
- Extended exception hierarchy with error_type/http_status class attributes
- Granular error detection (age-restricted, private, geo-blocked, network, rate-limited)
- FastAPI exception handler returns structured JSON with error_type
- CLI shows "[red]YouTube Error:[/red]" with verbose cause display
- Complete README documentation with CLI/API examples

---

## Milestone Summary

**Decimal Phases:**
- None (no urgent insertions during v2.1)

**Key Decisions:**
- Use yt-dlp for YouTube downloads (only viable option)
- m4a format for audio extraction (smaller than wav, faster-whisper compatible)
- UUID-based temp filenames (collision-free concurrent downloads)
- DOWNLOADING status for YouTube jobs (separate download from transcription)
- download_progress field 0-100 (basic progress without complex hooks)
- Class-level error_type on exceptions (enables API structured responses)

**Issues Resolved:**
- FFmpeg validation with helpful install instructions
- Temp file cleanup in all scenarios (success and failure)
- Orphaned import (cleanup_youtube_temp_dir) - low priority tech debt

**Issues Deferred:**
- Real-time download progress (yt-dlp progress hooks complex)
- Non-YouTube platforms (scope limited to YouTube only)
- Playlist auto-expansion (unclear user intent)

**Technical Debt Incurred:**
- cleanup_youtube_temp_dir() imported but not called in CLI (line 28)

---

_For current project status, see .planning/PROJECT.md_
